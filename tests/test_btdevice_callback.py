import logging
import os
import sys
import unittest
from unittest.mock import Mock

from paho.mqtt import publish

sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), "..", "src")))

from juntek_monitor import config
from juntek_monitor.btdevice import BTDevice
from juntek_monitor.jtdata import JTData


class TestBTDeviceCallback(unittest.TestCase):
    btdevice: BTDevice = None
    jtdata: JTData = None

    @classmethod
    def setUpClass(cls):
        options = config.ArgParser().parse_args()
        options.juntec_addr = "aa:bb:cc:dd:ee:ff"
        options.battery_capacity = 300
        cls.jtdata = JTData()
        cls.btdevice = BTDevice(options, cls.jtdata, logging.getLogger())
        publish.multiple = Mock()

    def test_jt_batt_v(self):
        self.btdevice._callback(bytes.fromhex("bb 13 49 c0 c1 ee"))
        self.assertEqual(list(self.jtdata.values()), [("Juntek-Monitor/jt_batt_v", 13.49)])

    def test_jt_current(self):
        self.btdevice._callback(bytes.fromhex("bb 02 10 c1 c1 ee"))
        self.assertEqual(list(self.jtdata.values()), [("Juntek-Monitor/jt_current", 2.1)])

    # these massive dumps were collected by looping a modified
    # https://github.com/hbldh/bleak/tree/develop/examples/enable_notifications.py
    # against a 300 Ah battery system with and without solar panels engaged.
    # they have reports with multiple values, concatenated multiple reports and even some errors.

    def test_jt_massive_charging(self):
        massive = """
BB 71 78 56 D4 18 EE BB 29 57 38 D2 81 EE BB 71
BB 71 78 60 D4 28 EE
BB 13 34 C0 20 01 D8 99 EE
BB 29 57 41 D2 90 EE
BB 13 33 C0 19 99 D8 43 EE
BB 71 78 61 D4 29 EE
BB 01 40 C1 18 66 D8 87 EE
BB 29 57 42 D2 91 EE
BB 01 50 C1 19 99 D8 55 EE
BB 71 78 62 D4 30 EE
BB 71 78 63 D4 31 EE
BB 29 57 43 D2 92 EE
BB 71 78 64 D4 32 EE
BB 29 57 44 D2 93 EE
BB 01 70 D6 14 EE
BB 71 78 65 D4 33 EE
BB 29 57 45 D2 94 EE
BB 71 78 66 D4 34 EE
BB 29 57 46 D2 71 78 67 D4 43 EE
BB 71 78 68 D4 36 EE
BB 29 57 47 D2 96 EE
BB 71 78 69 D4 37 EE
BB 29 57 48 D2 71 78 70 D4 54 EE
BB 29 57 49 D2 71 78 71 D4 56 EE
BB 00 C1 00 D1 00 D8 05 EE
BB 01 20 C1 01 D1 15 99 D8 13 EE
BB 71 78 72 D4 46 EE
BB 01 50 C1 19 99 D8 55 EE
BB 01 20 C1 15 99 D8 03 EE
BB 29 57 50 D2 05 EE
BB 90 C1 11 99 D8 10 EE
BB 71 78 73 D4 47 EE
BB 50 C1 06 66 D8 84 EE
BB 60 C1 07 99 D8 52 EE
BB 01 00 C1 13 33 D8 67 EE
BB 01 40 C1 18 66 D8 87 EE
BB 29 57 51 D2 06 EE
BB 01 60 C1 21 32 D8 76 EE
BB 71 78 74 D4 48 EE
BB 71 78 75 D4 49 EE
BB 29 57 52 D2 07 EE
BB 01 96 D6 00 D7 67 EE
BB 71 78 76 D4 50 EE
BB 29 57 53 D2 08 EE
BB 71 78 77 D4 51 EE
BB 29 57 54 D2 71 78 78 D4 74 EE
BB 29 57 55 D2 71 78 79 D4 76 EE
BB 71 78 80 D4 60 EE
BB 29 57 56 D2 71 78 81 D4 85 EE
BB 13 34 C0 21 34 D8 51 EE
BB 01 59 D6 06 25 D7 49 EE
BB 29 57 57 D2 71 78 82 D4 87 EE
BB 13 33 C0 21 32 D8 48 EE
BB 29 57 58 D2 71 78 83 D4 89 EE
BB 29 57 59 D2 71 78 84 D4 91 EE
BB 71 78 85 D4 65 EE
BB 29 57 60 D2 71 78 86 D4 00 EE
BB 01 50 C1 19 99 D8 55 EE
BB 29 57 61 D2 71 78 87 D4 02 EE
BB 71 78 88 D4 68 EE
BB 01 61 D6 00 D7 14 EE
BB 29 57 62 D2 23 EE
BB 71 78 89 D4 69 EE
BB 29 57 63 D2 71 78 90 D4 13 EE
BB 29 57 64 D2 71 78 91 D4 15 EE
BB 71 78 92 D4 78 EE
BB 29 57 65 D2 71 78 93 D4 18 EE
BB 71 79 36 D4 87 EE BB 29 57 98 D2 77 EE BB 01
BB 01 40 C1 18 66 D8 87 EE
BB 29 58 00 D2 71 79 39 D4 29 EE
BB 01 50 C1 19 99 D8 55 EE
BB 01 40 C1 18 66 D8 87 EE
BB 01 50 C1 01 75 D6 19 99 D8 87 EE
BB 71 79 40 D4 97 EE
BB 29 58 01 D2 71 79 41 D4 38 EE
BB 01 40 C1 18 66 D8 87 EE
BB 01 50 C1 19 99 D8 55 EE
BB 29 58 02 D2 71 79 42 D4 40 EE
BB 01 40 C1 18 66 D8 87 EE
BB 71 79 43 D4 00 EE
BB 13 34 C0 18 67 D8 93 EE
BB 13 33 C0 18 66 D8 91 EE
BB 29 58 03 D2 29 EE
BB 71 79 44 D4 01 EE
BB 29 58 04 D2 30 EE
BB 01 50 C1 19 99 D8 55 EE
BB 71 79 45 D4 02 EE
BB 01 74 D6 18 EE
BB 29 58 05 D2 71 79 46 D4 47 EE
BB 01 40 C1 18 66 D8 87 EE
BB 29 58 06 D2 71 79 47 D4 49 EE
BB 71 79 48 D4 05 EE
BB 01 50 C1 19 99 D8 55 EE
BB 01 40 C1 18 66 D8 87 EE
BB 29 58 07 D2 71 79 49 D4 52 EE
BB 01 50 C1 19 99 D8 55 EE
BB 29 58 08 D2 71 79 50 D4 60 EE
BB 01 40 C1 18 66 D8 87 EE
BB 01 50 C1 19 99 D8 55 EE
BB 71 79 51 D4 14 EE
BB 01 40 C1 18 66 D8 87 EE
BB 29 58 09 D2 35 EE
BB 71 79 52 D4 15 EE
BB 29 58 10 D2 42 EE
BB 71 79 53 D4 16 EE
BB 29 58 11 D2 71 79 54 D4 73 EE
BB 29 58 12 D2 71 79 55 D4 75 EE
BB 71 79 56 D4 19 EE
BB 01 79 D6 23 EE
BB 29 58 13 D2 45 EE
BB 71 79 57 D4 20 EE
BB 01 50 C1 19 99 D8 55 EE
BB 29 58 14 D2 71 79 58 D4 80 EE
BB 01 40 C1 18 66 D8 87 EE
BB 71 79 59 D4 22 EE
BB 29 58 15 D2 47 EE
BB 71 79 60 D4 29 EE
BB 29 58 16 D2 71 79 61 D4 91 EE
BB 29 58 17 D2 71 79 62 D4 93 EE
BB 01 78 D6 22 EE
BB 71 79 63 D4 32 EE
BB 29 58 18 D2 50 EE
BB 71 79 64 D4 33 EE
BB 29 58 19 D2 51 EE
BB 71 79 65 D4 34 EE
BB 29 58 20 D2 71 79 66 D4 06 EE
BB 71 79 67 D4 36 EE
BB 01 79 D6 23 EE
BB 29 58 21 D2 59 EE
BB 01 30 C1 17 32 D8 18 EE
BB 71 79 68 D4 37 EE
BB 01 40 C1 18 66 D8 87 EE
BB 29 58 22 D2 60 EE
BB 71 79 69 D4 38 EE
BB 29 58 23 D2 71 79 70 D4 19 EE
BB 01 30 C1 17 32 D8 18 EE BB 29 58 32 D2 71 79
BB 71 79 85 D4 66 EE
BB 29 58 35 D2 71 79 86 D4 59 EE
BB 01 40 C1 18 66 D8 87 EE
BB 71 79 87 D4 68 EE
BB 01 30 C1 17 32 D8 18 EE
BB 29 58 36 D2 80 EE
BB 01 87 D6 37 EE
BB 71 79 88 D4 69 EE
BB 29 58 37 D2 81 EE
BB 71 79 89 D4 70 EE
BB 01 40 C1 18 66 D8 87 EE
BB 13 34 C0 18 67 D8 93 EE
BB 01 30 C1 17 34 D8 20 EE
BB 29 58 38 D2 71 79 90 D4 72 EE
BB 13 33 C0 17 32 D8 38 EE
BB 71 79 91 D4 78 EE
BB 29 58 39 D2 83 EE
BB 71 79 92 D4 79 EE
BB 01 89 D6 39 EE
BB 29 58 40 D2 71 79 93 D4 83 EE
BB 01 40 C1 18 66 D8 87 EE
BB 01 30 C1 17 32 D8 18 EE
BB 29 58 41 D2 91 EE
BB 71 79 94 D4 81 EE
BB 29 58 42 D2 71 79 95 D4 87 EE
BB 71 79 96 D4 83 EE
BB 29 58 43 D2 93 EE
BB 71 79 97 D4 84 EE
BB 01 90 D6 46 EE
BB 01 20 C1 15 99 D8 03 EE
BB 29 58 44 D2 71 79 98 D4 92 EE
BB 01 30 C1 17 32 D8 18 EE
BB 01 20 C1 15 99 D8 03 EE
BB 01 30 C1 17 32 D8 18 EE
BB 71 79 99 D4 86 EE
BB 29 58 45 D2 95 EE
BB 71 80 00 D4 40 EE
BB 29 58 46 D2 96 EE
BB 01 20 C1 15 99 D8 03 EE
BB 71 80 01 D4 41 EE
BB 01 30 C1 17 32 D8 18 EE
BB 29 58 47 D2 71 80 02 D4 52 EE
BB 01 20 C1 15 99 D8 03 EE
BB 01 97 D6 53 EE
BB 01 30 C1 17 32 D8 18 EE
BB 29 58 48 D2 71 80 03 D4 54 EE
BB 13 34 C0 01 20 C1 16 00 D8 14 EE
BB 01 30 C1 17 34 D8 20 EE
BB 71 80 04 D4 44 EE
BB 29 58 49 D2 99 EE
BB 01 20 C1 16 00 D8 51 EE
BB 71 80 05 D4 45 EE
BB 13 33 C0 15 99 D8 39 EE
BB 29 58 50 D2 71 80 06 D4 65 EE
BB 01 30 C1 17 32 D8 18 EE
BB 01 20 C1 15 99 D8 03 EE
BB 71 80 07 D4 47 EE
BB 01 10 C1 14 66 D8 35 EE
BB 02 00 D6 03 EE
BB 29 58 51 D2 07 EE
BB 71 80 08 D4 48 EE
BB 29 58 52 D2 08 EE
BB 71 80 09 D4 49 EE
BB 29 58 53 D2 71 80 10 D4 78 EE
BB 71 80 11 D4 57 EE
BB 29 58 54 D2 10 EE
BB 02 26 D6 41 EE
BB 71 80 12 D4 58 EE
BB 71 80 40 D4 04 EE BB 29 58 76 D2 71 80 41 D4
BB 90 C1 11 99 D8 10 EE
BB 71 80 43 D4 07 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 58 78 D2 46 EE
BB 90 C1 11 99 D8 10 EE
BB 01 00 C1 13 33 D8 67 EE
BB 71 80 44 D4 08 EE
BB 90 C1 11 99 D8 10 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 58 79 D2 47 EE
BB 71 80 45 D4 09 EE
BB 02 51 D6 84 EE
BB 29 58 80 D2 71 80 46 D4 77 EE
BB 71 80 47 D4 11 EE
BB 29 58 81 D2 55 EE
BB 71 80 48 D4 12 EE
BB 29 58 82 D2 56 EE
BB 02 47 D6 74 EE
BB 71 80 49 D4 13 EE
BB 90 C1 11 99 D8 10 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 58 83 D2 71 80 50 D4 90 EE
BB 71 80 51 D4 21 EE
BB 29 58 84 D2 58 EE
BB 90 C1 11 99 D8 10 EE
BB 71 80 52 D4 22 EE
BB 02 56 D6 89 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 58 85 D2 71 80 53 D4 95 EE
BB 90 C1 11 99 D8 10 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 58 86 D2 71 80 54 D4 97 EE
BB 90 C1 11 99 D8 10 EE
BB 01 00 C1 13 33 D8 67 EE
BB 90 C1 11 99 D8 10 EE
BB 71 80 55 D4 25 EE
BB 29 58 87 D2 61 EE
BB 70 C1 09 33 D8 68 EE
BB 80 C1 10 66 D8 42 EE
BB 70 C1 09 33 D8 68 EE
BB 71 80 56 D4 26 EE
BB 02 74 D6 19 EE
BB 80 C1 10 66 D8 42 EE
BB 70 C1 09 33 D8 68 EE
BB 29 58 88 D2 62 EE
BB 71 80 57 D4 27 EE
BB 80 C1 10 66 D8 42 EE
BB 70 C1 09 33 D8 68 EE
BB 29 58 89 D2 71 80 58 D4 04 EE
BB 03 46 D6 74 EE
BB 71 80 59 D4 29 EE
BB 29 58 90 D2 70 EE
BB 71 80 60 D4 36 EE
BB 29 58 91 D2 71 EE
BB 71 80 61 D4 37 EE
BB 13 34 C0 03 52 D6 14 28 D7 24 EE
BB 70 C1 09 33 D8 68 EE BB 80 C1 10 66 D8 42 EE
BB 03 14 D6 24 EE
BB 29 59 00 D2 27 EE
BB 71 80 73 D4 55 EE
BB 29 59 01 D2 71 80 74 D4 97 EE
BB 71 80 75 D4 57 EE
BB 29 59 02 D2 29 EE
BB 02 73 D6 18 EE
BB 71 80 76 D4 58 EE
BB 29 59 03 D2 30 EE
BB 71 80 77 D4 59 EE
BB 71 80 78 D4 60 EE
BB 29 59 04 D2 31 EE
BB 80 C1 10 66 D8 42 EE
BB 71 80 79 D4 61 EE
BB 02 80 D6 31 EE
BB 29 59 05 D2 32 EE
BB 71 80 80 D4 68 EE
BB 29 59 06 D2 33 EE
BB 71 80 81 D4 69 EE
BB 71 80 82 D4 70 EE
BB 29 59 07 D2 34 EE
BB 03 06 D6 10 EE
BB 71 80 83 D4 71 EE
BB 70 C1 09 33 D8 68 EE
BB 29 59 08 D2 35 EE
BB 80 C1 10 66 D8 42 EE
BB 71 80 84 D4 72 EE
BB 90 C1 11 99 D8 10 EE
BB 29 59 09 D2 71 80 85 D4 22 EE
BB 01 00 C1 13 33 D8 67 EE
BB 90 C1 02 99 D6 11 99 D8 79 EE
BB 71 80 86 D4 74 EE
BB 29 59 10 D2 43 EE
BB 71 80 87 D4 75 EE
BB 01 00 C1 13 33 D8 67 EE
BB 90 C1 11 99 D8 10 EE
BB 29 59 11 D2 44 EE
BB 71 80 88 D4 76 EE
BB 02 70 D6 15 EE
BB 29 59 12 D2 71 80 89 D4 35 EE
BB 71 80 90 D4 84 EE
BB 29 59 13 D2 46 EE
BB 71 80 91 D4 85 EE
BB 01 00 C1 13 33 D8 67 EE BB 71 81 07 D4 48 EE
BB 29 59 27 D2 66 EE
BB 71 81 09 D4 50 EE
BB 02 69 D6 08 EE
BB 29 59 28 D2 71 81 10 D4 37 EE
BB 71 81 11 D4 58 EE
BB 29 59 29 D2 68 EE
BB 71 81 12 D4 59 EE
BB 29 59 30 D2 75 EE
BB 71 81 13 D4 60 EE
BB 02 71 D6 16 EE
BB 29 59 31 D2 71 81 14 D4 50 EE
BB 71 81 15 D4 62 EE
BB 29 59 32 D2 77 EE
BB 71 81 16 D4 63 EE
BB 29 59 33 D2 78 EE
BB 71 81 17 D4 64 EE
BB 29 59 34 D2 71 81 18 D4 57 EE
BB 01 00 C1 13 33 D8 67 EE
BB 71 81 19 D4 66 EE
BB 29 59 35 D2 80 EE
BB 90 C1 11 99 D8 10 EE
BB 02 63 D6 02 EE
BB 71 81 20 D4 73 EE
BB 29 59 36 D2 81 EE
BB 01 00 C1 13 33 D8 67 EE
BB 71 81 21 D4 74 EE
BB 90 C1 11 99 D8 10 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 59 37 D2 71 81 22 D4 70 EE
BB 90 C1 11 99 D8 10 EE
BB 01 00 C1 13 33 D8 67 EE
BB 71 81 23 D4 76 EE
BB 29 59 38 D2 83 EE
BB 02 53 D6 86 EE
BB 71 81 24 D4 77 EE
BB 29 59 39 D2 84 EE
BB 71 81 25 D4 78 EE
BB 90 C1 11 99 D8 10 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 59 40 D2 71 81 26 D4 83 EE
BB 71 81 27 D4 80 EE
BB 02 46 D6 73 EE
BB 90 C1 11 99 D8 10 EE
BB 29 59 41 D2 92 EE
BB 01 00 C1 13 33 D8 67 EE
BB 71 81 28 D4 81 EE
BB 29 59 42 D2 93 EE
BB 71 81 29 D4 82 EE
BB 90 C1 11 99 D8 10 EE BB 71 81 36 D4 95 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 59 48 D2 99 EE
BB 71 81 37 D4 96 EE
BB 29 59 49 D2 71 81 38 D4 10 EE
BB 90 C1 02 52 D6 11 99 D8 08 EE
BB 71 81 39 D4 98 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 59 50 D2 07 EE
BB 71 81 40 D4 05 EE
BB 29 59 51 D2 08 EE
BB 71 81 41 D4 06 EE
BB 90 C1 11 99 D8 10 EE
BB 01 00 C1 13 33 D8 67 EE
BB 13 34 C0 13 34 D8 37 EE
BB 13 33 C0 13 33 D8 35 EE
BB 29 59 52 D2 71 81 42 D4 29 EE
BB 02 47 D6 74 EE
BB 71 81 43 D4 08 EE
BB 29 59 53 D2 10 EE
BB 90 C1 11 99 D8 10 EE
BB 71 81 44 D4 09 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 59 54 D2 11 EE
BB 71 81 45 D4 10 EE
BB 02 44 D6 71 EE
BB 29 59 55 D2 71 81 46 D4 36 EE
BB 71 81 47 D4 12 EE
BB 29 59 56 D2 13 EE
BB 71 81 48 D4 13 EE
BB 29 59 57 D2 14 EE
BB 13 34 C0 13 34 D8 37 EE
BB 71 81 49 D4 14 EE
BB 13 33 C0 13 33 D8 35 EE
BB 71 81 50 D4 21 EE
BB 02 42 D6 69 EE
BB 29 59 58 D2 15 EE
BB 71 81 51 D4 22 EE
BB 29 59 59 D2 16 EE
BB 90 C1 11 99 D8 10 EE
BB 71 81 52 D4 23 EE
BB 13 34 C0 01 00 C1 13 34 D8 31 EE
BB 29 59 60 D2 23 EE
BB 71 81 53 D4 24 EE
BB 02 47 D6 10 00 D7 05 EE
BB 71 81 54 D4 25 EE
BB 13 33 C0 13 33 D8 35 EE
BB 29 59 61 D2 24 EE
BB 71 81 55 D4 26 EE
BB 29 59 62 D2 25 EE
BB 13 34 C0 13 34 D8 37 EE
BB 13 33 C0 13 33 D8 35 EE
BB 71 81 56 D4 27 EE
BB 29 59 63 D2 26 EE
BB 71 81 57 D4 28 EE
BB 02 42 D6 00 D7 84 EE
BB 71 81 58 D4 29 EE
BB 90 C1 11 99 D8 10 EE BB 29 60 23 D2 71 82 37
BB 13 33 C0 10 66 D8 83 EE
BB 29 60 24 D2 70 EE
BB 02 78 D6 23 EE
BB 13 34 C0 90 C1 12 00 D8 21 EE
BB 71 82 39 D4 99 EE
BB 13 33 C0 11 99 D8 35 EE
BB 29 60 25 D2 71 EE
BB 71 82 40 D4 06 EE
BB 29 60 26 D2 72 EE
BB 71 82 41 D4 07 EE
BB 02 68 D6 07 EE
BB 29 60 27 D2 71 82 42 D4 94 EE
BB 71 82 43 D4 09 EE
BB 29 60 28 D2 74 EE
BB 71 82 44 D4 10 EE
BB 01 00 C1 13 33 D8 67 EE
BB 90 C1 11 99 D8 10 EE
BB 29 60 29 D2 75 EE
BB 71 82 45 D4 11 EE
BB 02 62 D6 01 EE
BB 29 60 30 D2 71 82 46 D4 07 EE
BB 01 00 C1 13 33 D8 67 EE
BB 71 82 47 D4 13 EE
BB 90 C1 11 99 D8 10 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 60 31 D2 83 EE
BB 90 C1 11 99 D8 10 EE
BB 71 82 48 D4 14 EE
BB 01 00 C1 13 33 D8 67 EE
BB 13 34 C0 13 34 D8 37 EE
BB 90 C1 12 00 D8 58 EE
BB 01 00 C1 02 57 D6 10 00 D7 13 34 D8 02 EE
BB 29 60 32 D2 71 82 49 D4 12 EE
BB 90 C1 12 00 D8 58 EE
BB 01 00 C1 13 34 D8 68 EE
BB 71 82 50 D4 22 EE
BB 90 C1 12 00 D8 58 EE
BB 29 60 33 D2 85 EE
BB 13 33 C0 11 99 D8 35 EE
BB 71 82 51 D4 23 EE
BB 01 00 C1 13 33 D8 67 EE
BB 29 60 34 D2 86 EE
BB 71 82 52 D4 24 EE
BB 02 48 D6 00 D7 90 EE
BB 90 C1 11 99 D8 10 EE
BB 29 60 35 D2 71 82 53 D4 25 EE
BB 13 34 C0 12 00 D8 84 EE
BB 71 82 54 D4 26 EE
BB 13 33 C0 11 99 D8 35 EE
BB 29 60 36 D2 88 EE
BB 01 00 C1 13 33 D8 67 EE
BB 71 82 55 D4 27 EE
BB 90 C1 11 99 D8 10 EE
BB 13 34 C0 01 00 C1 13 34 D8 31 EE
BB 29 60 37 D2 89 EE
BB 90 C1 12 00 D8 58 EE
BB 71 82 56 D4 28 EE
BB 13 33 C0 02 58 D6 11 99 D8 39 EE
BB 29 60 38 D2 71 82 57 D4 32 EE
BB 01 00 C1 13 33 D8 67 EE
BB 71 82 58 D4 30 EE
BB 90 C1 11 99 D8 10 EE
BB 29 60 39 D2 91 EE
BB 01 00 C1 13 33 D8 67 EE
"""
        self.btdevice._callback(bytes.fromhex(massive))
        self.assertEqual(
            list(self.jtdata.values()),
            [
                ("Juntek-Monitor/jt_batt_v", 13.34),
                ("Juntek-Monitor/jt_current", 1.4),
                ("Juntek-Monitor/jt_watts", 20.01),
                ("Juntek-Monitor/jt_batt_charging", "Charging"),
                ("Juntek-Monitor/jt_soc", 98),
                ("Juntek-Monitor/jt_ah_remaining", 295.738),
                ("Juntek-Monitor/jt_acc_cap", 7.17856),
                ("Juntek-Monitor/jt_min_remaining", 170),
            ],
        )

    def test_jt_massive_discharging(self):
        massive = """
BB 20 C1 02 67 D8 33 EE BB 30 C1 04 01 D8 49 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 01 38 34 D6 04 01 D8 72 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 29 76 39 D2 07 29 62 D3 70 EE
BB 77 28 D6 60 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 01 16 89 D6 61 EE
BB 29 76 38 D2 07 29 63 D3 70 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 01 85 02 D6 37 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 29 76 37 D2 07 29 64 D3 70 EE
BB 77 28 D6 60 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 01 85 02 D6 37 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE BB 29 76 29 D2 07 29 72
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 77 26 D6 58 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 29 76 28 D2 07 29 73 D3 70 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 13 36 C0 04 00 D8 72 EE
BB 20 C1 02 67 D8 33 EE
BB 96 54 D6 35 EE
BB 13 37 C0 30 C1 04 01 D8 15 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 29 76 27 D2 07 29 74 D3 70 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 77 26 D6 58 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 24 93 D6 04 01 D8 46 EE
BB 29 76 26 D2 07 29 75 D3 70 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 58 94 D6 04 01 D8 99 EE
BB 20 C1 02 67 D8 01 24 D9 87 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 29 76 25 D2 07 29 76 D3 70 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 01 D8 49 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE BB 29 76 08 D2 07 29 93
BB 13 37 C0 96 49 D6 90 EE
BB 30 C1 04 01 D8 49 EE
BB 13 36 C0 04 00 D8 72 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 13 37 C0 53 EE
BB 13 36 C0 52 EE
BB 29 76 07 D2 07 29 94 D3 70 EE
BB 30 C1 04 00 D8 48 EE
BB 13 37 C0 41 47 D6 04 01 D8 24 EE
BB 20 C1 02 67 D8 33 EE
BB 13 36 C0 52 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 01 38 25 D6 95 EE
BB 30 C1 04 00 D8 48 EE
BB 29 76 06 D2 07 29 95 D3 70 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 77 20 D6 04 00 D8 13 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 29 76 05 D2 07 29 96 D3 70 EE
BB 96 48 D6 23 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 58 89 D6 26 EE
BB 30 C1 04 00 D8 48 EE
BB 29 76 04 D2 07 29 97 D3 70 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 01 38 24 D6 04 00 D8 55 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 13 37 C0 04 01 D8 74 EE
BB 13 36 C0 04 00 D8 72 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 29 76 00 D2 07 30 01 D3 23 EE
BB 20 C1 41 45 D6 02 67 D8 81 EE
BB 13 37 C0 53 EE
BB 13 36 C0 52 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 96 47 D6 22 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 29 75 99 D2 07 30 02 D3 76 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 01 16 78 D6 04 00 D8 05 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 29 75 98 D2 07 30 03 D3 76 EE
BB 20 C1 02 67 D8 33 EE
BB 77 18 D6 44 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 09 04 D6 02 67 D8 60 EE
BB 29 75 97 D2 07 30 04 D3 76 EE
BB 30 C1 04 00 D8 48 EE BB 77 18 D6 44 EE BB 20
BB 29 75 94 D2 07 30 07 D3 76 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 01 38 22 D6 92 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 13 37 C0 53 EE
BB 30 C1 04 01 D8 49 EE
BB 13 36 C0 58 86 D6 04 00 D8 08 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 29 75 93 D2 07 30 08 D3 76 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 13 37 C0 04 01 D8 74 EE
BB 13 36 C0 20 C1 02 67 D8 98 EE
BB 77 17 D6 43 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 29 75 92 D2 07 30 09 D3 76 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 96 45 D6 20 EE
BB 30 C1 04 00 D8 48 EE
BB 29 75 91 D2 07 30 10 D3 82 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 58 85 D6 02 67 D8 68 EE
BB 30 C1 04 00 D8 48 EE BB 29 75 85 D2 07 30 16
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 09 01 D6 11 EE
BB 29 75 84 D2 07 30 17 D3 76 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 06 21 04 D6 02 67 D8 90 EE
BB 29 75 83 D2 07 30 18 D3 76 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 77 15 D6 02 67 D8 87 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 29 75 82 D2 07 30 19 D3 76 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 06 49 26 D6 18 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 29 75 81 D2 07 30 20 D3 82 EE
BB 20 C1 77 14 D6 02 67 D8 86 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 20 C1 02 67 D8 33 EE
BB 30 C1 04 00 D8 48 EE
BB 58 83 D6 20 EE
"""
        self.btdevice._callback(bytes.fromhex(massive))
        self.assertEqual(
            list(self.jtdata.values()),
            [
                ("Juntek-Monitor/jt_batt_v", 13.36),
                ("Juntek-Monitor/jt_current", 0.2),
                ("Juntek-Monitor/jt_watts", 2.67),
                ("Juntek-Monitor/jt_batt_charging", "Discharging"),
                ("Juntek-Monitor/jt_soc", 99),
                ("Juntek-Monitor/jt_ah_remaining", 297.639),
                ("Juntek-Monitor/jt_min_remaining", 13834),
                ("Juntek-Monitor/jt_temp", 24),
            ],
        )


if __name__ == "__main__":
    unittest.main()
